<!DOCTYPE html>
<html lang="bn" class="scroll-smooth" x-data="appState()" x-init="init()">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>CDN MX - Asset Manager</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Bengali:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.0/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Noto Serif Bengali"', 'ui-serif', 'Georgia', 'serif'],
                        serif: ['"Noto Serif Bengali"', 'ui-serif', 'Georgia', 'serif'],
                    },
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                }
            }
        }
    </script>

    <style>
        /* CSS Variables for ShadCN Theme */
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --radius: 0.75rem;
        }
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }

        /* Utilities */
        [x-cloak] { display: none !important; }
        
        body {
            font-family: 'Noto Serif Bengali', ui-serif, Georgia, serif !important;
            -webkit-tap-highlight-color: transparent;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.5);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(156, 163, 175, 0.8);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Checkerboard Pattern for Transparent Images */
        .checkerboard {
            background-color: hsl(var(--muted));
            background-image: 
                linear-gradient(45deg, #80808020 25%, transparent 25%), 
                linear-gradient(-45deg, #80808020 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #80808020 75%), 
                linear-gradient(-45deg, transparent 75%, #80808020 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        /* PB-SAFE for iOS Home Indicator */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-background text-foreground antialiased selection:bg-primary selection:text-primary-foreground min-h-screen flex flex-col md:flex-row overflow-hidden transition-colors duration-300"
      :class="{ 'overflow-hidden': isModalOpen }">

    <!-- Desktop Sidebar -->
    <aside class="hidden md:flex w-64 flex-col border-r border-border bg-card z-20 shadow-sm">
        <div class="p-6 flex items-center gap-3">
            <div class="h-10 w-10 rounded-xl bg-primary text-primary-foreground flex items-center justify-center font-bold text-lg shadow-lg">CM</div>
            <div>
                <h1 class="font-bold text-lg leading-none">CDN MX</h1>
                <p class="text-xs text-muted-foreground mt-1">Asset Manager</p>
            </div>
        </div>
        
        <nav class="flex-1 px-4 space-y-2 overflow-y-auto">
            <div class="text-xs font-semibold text-muted-foreground px-2 mb-2 uppercase tracking-wider">মেনু</div>
            <button @click="setActiveCategory('all')" 
                :class="activeCategory === 'all' ? 'bg-secondary text-secondary-foreground shadow-sm' : 'text-muted-foreground hover:bg-secondary/50 hover:text-foreground'" 
                class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all">
                <i class="bi bi-grid-fill"></i> সকল অ্যাসেট
            </button>
            <template x-for="cat in categories" :key="cat.id">
                <button @click="setActiveCategory(cat.id)" 
                    :class="activeCategory === cat.id ? 'bg-secondary text-secondary-foreground shadow-sm' : 'text-muted-foreground hover:bg-secondary/50 hover:text-foreground'" 
                    class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all">
                    <i :class="cat.icon"></i> <span x-text="cat.name"></span>
                </button>
            </template>
        </nav>

        <div class="p-4 border-t border-border">
            <button @click="toggleTheme" class="w-full flex items-center justify-between px-3 py-2.5 rounded-lg border border-border bg-background hover:bg-accent text-sm font-medium transition-colors">
                <span class="flex items-center gap-2"><i class="bi" :class="isDarkMode ? 'bi-moon-stars-fill' : 'bi-sun-fill'"></i> থিম পরিবর্তন</span>
            </button>
        </div>
    </aside>

    <!-- Main Content Wrapper -->
    <div class="flex-1 flex flex-col h-screen overflow-hidden relative">
        
        <!-- Header -->
        <header class="h-16 md:h-20 border-b border-border bg-background/80 backdrop-blur-md flex items-center justify-between px-4 md:px-8 z-20 shrink-0">
            <!-- Mobile Logo -->
            <div class="md:hidden flex items-center gap-2">
                <div class="h-8 w-8 rounded-lg bg-primary text-primary-foreground flex items-center justify-center font-bold text-sm">CM</div>
                <span class="font-bold text-lg">CDN MX</span>
            </div>

            <!-- Search Bar -->
            <div class="flex-1 max-w-xl mx-auto md:mx-0 px-2 md:px-0 relative group">
                <div class="absolute inset-y-0 left-0 pl-3 md:pl-0 flex items-center pointer-events-none md:left-3">
                    <i class="bi bi-search text-muted-foreground group-focus-within:text-primary transition-colors"></i>
                </div>
                <input type="text" x-model="searchTerm" 
                    class="h-10 w-full rounded-full border border-input bg-secondary/50 px-3 pl-10 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all"
                    placeholder="অ্যাসেট খুঁজুন... (নাম বা ধরণ)">
                <button x-show="searchTerm" @click="searchTerm = ''" class="absolute inset-y-0 right-2 md:right-3 pr-2 flex items-center text-muted-foreground hover:text-destructive cursor-pointer transition-colors" x-cloak>
                    <i class="bi bi-x-circle-fill"></i>
                </button>
            </div>

            <!-- Desktop Tools -->
            <div class="hidden md:flex items-center gap-2">
                 <!-- Sort Dropdown -->
                 <div class="relative" x-data="{ open: false }" @click.away="open = false">
                    <button @click="open = !open" class="flex items-center gap-2 px-4 py-2 rounded-full border border-border hover:bg-accent transition-colors text-sm font-medium">
                        <i class="bi bi-sort-down"></i> <span x-text="getSortLabel(sortBy)"></span>
                    </button>
                    <div x-show="open" 
                         x-transition:enter="transition ease-out duration-200"
                         x-transition:enter-start="opacity-0 scale-95"
                         x-transition:enter-end="opacity-100 scale-100"
                         x-transition:leave="transition ease-in duration-150"
                         x-transition:leave-start="opacity-100 scale-100"
                         x-transition:leave-end="opacity-0 scale-95"
                         class="absolute right-0 mt-2 w-48 bg-popover text-popover-foreground rounded-xl shadow-lg border border-border py-1 z-50" x-cloak>
                        <a href="#" @click.prevent="sortBy = 'name'; open = false" class="block px-4 py-2 text-sm hover:bg-accent transition-colors">নাম (A-Z)</a>
                        <a href="#" @click.prevent="sortBy = 'date'; open = false" class="block px-4 py-2 text-sm hover:bg-accent transition-colors">তারিখ (নতুন-পুরানো)</a>
                        <a href="#" @click.prevent="sortBy = 'size'; open = false" class="block px-4 py-2 text-sm hover:bg-accent transition-colors">সাইজ (ছোট-বড়)</a>
                    </div>
                </div>
                
                <div class="flex bg-secondary rounded-lg p-1 border border-border">
                    <button @click="viewMode = 'grid'" :class="viewMode === 'grid' ? 'bg-background shadow-sm text-foreground' : 'text-muted-foreground hover:text-foreground'" class="p-2 rounded-md transition-all text-sm"><i class="bi bi-grid-fill"></i></button>
                    <button @click="viewMode = 'list'" :class="viewMode === 'list' ? 'bg-background shadow-sm text-foreground' : 'text-muted-foreground hover:text-foreground'" class="p-2 rounded-md transition-all text-sm"><i class="bi bi-list-ul"></i></button>
                </div>
            </div>
            
            <!-- Mobile Filter Toggle -->
            <button @click="mobileFilterOpen = !mobileFilterOpen" class="md:hidden p-2 text-muted-foreground hover:text-foreground transition-colors ml-2">
                <i class="bi bi-sliders2 text-xl"></i>
            </button>
        </header>
        
        <!-- Mobile Filter Sheet -->
        <div x-show="mobileFilterOpen" 
             x-collapse 
             class="md:hidden border-b border-border bg-secondary/30 backdrop-blur-sm px-4 py-4 space-y-4" x-cloak>
            <div class="flex justify-between items-center text-sm font-medium text-muted-foreground">
                <span>সাজান (Sort By)</span>
            </div>
            <div class="flex gap-2">
                <button @click="sortBy = 'name'" :class="sortBy === 'name' ? 'bg-primary text-primary-foreground' : 'bg-background border border-border text-foreground'" class="px-3 py-1.5 rounded-full text-xs font-medium flex-1 transition-all">নাম</button>
                <button @click="sortBy = 'date'" :class="sortBy === 'date' ? 'bg-primary text-primary-foreground' : 'bg-background border border-border text-foreground'" class="px-3 py-1.5 rounded-full text-xs font-medium flex-1 transition-all">তারিখ</button>
                <button @click="sortBy = 'size'" :class="sortBy === 'size' ? 'bg-primary text-primary-foreground' : 'bg-background border border-border text-foreground'" class="px-3 py-1.5 rounded-full text-xs font-medium flex-1 transition-all">সাইজ</button>
            </div>
             <div class="flex justify-between items-center text-sm font-medium text-muted-foreground mt-2">
                <span>ভিউ মোড</span>
            </div>
             <div class="flex gap-2">
                <button @click="viewMode = 'grid'" :class="viewMode === 'grid' ? 'bg-primary text-primary-foreground' : 'bg-background border border-border text-foreground'" class="px-3 py-1.5 rounded-full text-xs font-medium flex-1 transition-all"><i class="bi bi-grid-fill mr-1"></i> গ্রিড</button>
                <button @click="viewMode = 'list'" :class="viewMode === 'list' ? 'bg-primary text-primary-foreground' : 'bg-background border border-border text-foreground'" class="px-3 py-1.5 rounded-full text-xs font-medium flex-1 transition-all"><i class="bi bi-list-ul mr-1"></i> লিস্ট</button>
            </div>
        </div>

        <!-- Mobile Horizontal Categories -->
        <div class="md:hidden w-full overflow-x-auto no-scrollbar py-3 px-4 border-b border-border bg-background z-10 sticky top-0">
            <div class="flex gap-2 min-w-max">
                <button @click="setActiveCategory('all')" :class="activeCategory === 'all' ? 'bg-primary text-primary-foreground shadow-sm' : 'bg-secondary text-secondary-foreground border border-transparent'" class="px-4 py-1.5 rounded-full text-sm font-medium transition-all">সকল</button>
                <template x-for="cat in categories" :key="cat.id">
                    <button @click="setActiveCategory(cat.id)" :class="activeCategory === cat.id ? 'bg-primary text-primary-foreground shadow-sm' : 'bg-secondary text-secondary-foreground border border-transparent'" class="px-4 py-1.5 rounded-full text-sm font-medium transition-all flex items-center gap-2">
                        <i :class="cat.icon"></i> <span x-text="cat.name"></span>
                    </button>
                </template>
            </div>
        </div>

        <!-- Main Content Scroll Area -->
        <main class="flex-1 overflow-y-auto overflow-x-hidden p-4 md:p-6 pb-24 md:pb-6 scroll-smooth" id="main-scroll">
            
            <!-- Welcome Banner -->
            <div x-show="!searchTerm && activeCategory === 'all'" 
                 class="mb-6 rounded-2xl bg-gradient-to-br from-slate-900 via-slate-800 to-slate-700 dark:from-slate-100 dark:via-slate-200 dark:to-slate-300 p-6 text-white dark:text-slate-900 shadow-lg relative overflow-hidden transition-all duration-500">
                <div class="relative z-10">
                    <h2 class="text-2xl font-bold">CDN MX ড্যাশবোর্ড</h2>
                    <p class="text-slate-300 dark:text-slate-600 text-sm mt-1">আপনার সকল ডিজিটাল অ্যাসেট এক জায়গায় ম্যানেজ করুন।</p>
                    <div class="flex gap-6 mt-4">
                        <div>
                            <span class="text-2xl font-bold block" x-text="assets.length">0</span>
                            <span class="text-xs uppercase tracking-wider opacity-70">মোট ফাইল</span>
                        </div>
                        <div class="w-px bg-white/20 dark:bg-black/10"></div>
                        <div>
                            <span class="text-2xl font-bold block" x-text="categories.length">0</span>
                            <span class="text-xs uppercase tracking-wider opacity-70">ক্যাটাগরি</span>
                        </div>
                    </div>
                </div>
                <i class="bi bi-cloud-arrow-up-fill absolute -bottom-4 -right-4 text-9xl opacity-10 rotate-12"></i>
            </div>

            <!-- Loading State -->
            <div x-show="isLoading" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" x-cloak>
                <template x-for="i in 10">
                    <div class="bg-card rounded-xl border border-border p-3 space-y-3">
                        <div class="aspect-square bg-muted rounded-lg animate-pulse"></div>
                        <div class="h-4 bg-muted rounded w-3/4 animate-pulse"></div>
                        <div class="h-3 bg-muted rounded w-1/2 animate-pulse"></div>
                    </div>
                </template>
            </div>

            <!-- Asset Grid/List -->
            <div x-show="!isLoading">
                 <!-- Grid View -->
                <div x-show="viewMode === 'grid'" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                    <template x-for="(asset, index) in sortedAndFilteredAssets" :key="asset.id">
                        <div class="group bg-card hover:bg-accent/50 rounded-xl border border-border p-2 sm:p-3 transition-all cursor-pointer flex flex-col h-full hover:shadow-lg hover:-translate-y-1 duration-300" 
                             @click="openModal(asset)">
                            
                            <!-- Thumbnail -->
                            <div class="relative aspect-square rounded-lg overflow-hidden bg-muted checkerboard mb-3 border border-border/50">
                                <template x-if="['images', 'svg'].includes(asset.category) || asset.type === 'image'">
                                    <img :src="asset.fullPath || (BASE_URL + asset.path)" 
                                         @error="$el.style.display='none'; $el.nextElementSibling.style.display='flex'"
                                         loading="lazy" 
                                         class="w-full h-full object-contain p-2 transition-transform duration-500 group-hover:scale-110">
                                    <div class="w-full h-full flex items-center justify-center hidden">
                                        <i class="bi bi-image-fill text-3xl text-muted-foreground"></i>
                                    </div>
                                </template>
                                <template x-if="!(['images', 'svg'].includes(asset.category) || asset.type === 'image')">
                                    <div class="w-full h-full flex items-center justify-center bg-secondary/50">
                                        <i :class="getIconForType(asset.category)" class="text-4xl sm:text-5xl text-muted-foreground group-hover:text-primary transition-colors"></i>
                                    </div>
                                </template>
                                <!-- Badge -->
                                <div class="absolute top-1 right-1 px-1.5 py-0.5 bg-black/60 backdrop-blur text-white text-[10px] font-bold uppercase rounded tracking-wider shadow-sm">
                                    <span x-text="asset.extension || asset.type"></span>
                                </div>
                            </div>
                            
                            <!-- Info -->
                            <div class="flex-1 flex flex-col justify-between">
                                <div>
                                    <h3 class="font-medium text-foreground text-sm truncate" x-text="asset.name" :title="asset.name"></h3>
                                    <p class="text-xs text-muted-foreground mt-0.5" x-text="asset.size || 'N/A'"></p>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- List View -->
                <div x-show="viewMode === 'list'" class="space-y-2">
                    <template x-for="(asset, index) in sortedAndFilteredAssets" :key="asset.id">
                         <div class="flex items-center gap-3 bg-card p-2 rounded-xl border border-border hover:bg-accent transition-all cursor-pointer hover:shadow-md" 
                              @click="openModal(asset)">
                            <div class="h-12 w-12 rounded-lg bg-muted checkerboard flex items-center justify-center shrink-0 border border-border/50 overflow-hidden relative">
                                <template x-if="['images', 'svg'].includes(asset.category) || asset.type === 'image'">
                                    <img :src="asset.fullPath || (BASE_URL + asset.path)" loading="lazy" class="w-full h-full object-cover">
                                </template>
                                <template x-if="!(['images', 'svg'].includes(asset.category) || asset.type === 'image')">
                                    <i :class="getIconForType(asset.category)" class="text-xl text-muted-foreground"></i>
                                </template>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-foreground truncate" x-text="asset.name"></h4>
                                <div class="flex gap-2 text-xs text-muted-foreground mt-0.5">
                                    <span class="uppercase font-bold" x-text="asset.extension || asset.type"></span> &bull; <span x-text="asset.size"></span> &bull; <span x-text="formatDate(asset.date)"></span>
                                </div>
                            </div>
                            <button class="p-2 text-muted-foreground transition-colors hover:text-foreground">
                                <i class="bi bi-chevron-right"></i>
                            </button>
                         </div>
                    </template>
                </div>

                <!-- Empty State -->
                <div x-show="sortedAndFilteredAssets.length === 0" 
                     class="flex flex-col items-center justify-center py-20 text-center text-muted-foreground" x-cloak>
                    <div class="h-20 w-20 bg-muted/50 rounded-full flex items-center justify-center mb-4">
                        <i class="bi bi-search text-3xl opacity-50"></i>
                    </div>
                    <p class="text-lg font-medium text-foreground">কিছু পাওয়া যায়নি</p>
                    <p class="text-sm mt-1">অন্য কিওয়ার্ড চেষ্টা করুন বা ফিল্টার পরিবর্তন করুন</p>
                </div>
            </div>
        </main>

        <!-- Mobile Bottom Nav -->
        <nav class="md:hidden fixed bottom-0 w-full h-16 bg-background/90 backdrop-blur-lg border-t border-border flex justify-around items-center z-30 pb-safe">
            <button @click="setActiveCategory('all'); mobileFilterOpen = false;" :class="activeCategory === 'all' ? 'text-primary' : 'text-muted-foreground'" class="flex flex-col items-center gap-1 w-16 transition-all active:scale-95">
                <i :class="activeCategory === 'all' ? 'bi-house-fill' : 'bi-house'" class="text-xl"></i>
                <span class="text-[10px] font-medium">হোম</span>
            </button>
            <button @click="document.querySelector('input[type=text]').focus()" class="flex flex-col items-center gap-1 w-16 text-muted-foreground transition-all active:scale-95 active:text-primary">
                <i class="bi bi-search text-xl"></i>
                <span class="text-[10px] font-medium">সার্চ</span>
            </button>
            <button @click="toggleTheme" class="flex flex-col items-center gap-1 w-16 text-muted-foreground transition-all active:scale-95 active:text-primary">
                <i class="bi" :class="isDarkMode ? 'bi-moon-stars-fill' : 'bi-sun'"></i>
                <span class="text-[10px] font-medium">থিম</span>
            </button>
        </nav>
    </div>

    <!-- Details Modal -->
    <div x-show="isModalOpen" class="fixed inset-0 z-50 flex items-end md:items-center justify-center" x-cloak>
        <!-- Backdrop -->
        <div x-show="isModalOpen" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black/60 backdrop-blur-sm" @click="closeModal()"></div>

        <!-- Modal Panel -->
        <div x-show="isModalOpen" 
             x-transition:enter="transition ease-out duration-400" 
             x-transition:enter-start="translate-y-full md:scale-95 md:opacity-0 md:translate-y-0" 
             x-transition:enter-end="translate-y-0 md:scale-100 md:opacity-100"
             x-transition:leave="transition ease-in duration-300" 
             x-transition:leave-start="translate-y-0 md:scale-100 md:opacity-100" 
             x-transition:leave-end="translate-y-full md:scale-95 md:opacity-0 md:translate-y-0"
             class="bg-background w-full md:max-w-4xl h-[85vh] md:h-auto md:max-h-[85vh] md:rounded-2xl rounded-t-2xl shadow-2xl relative flex flex-col md:flex-row overflow-hidden border border-border z-50">
            
            <!-- Mobile Drag Handle -->
            <div class="md:hidden w-full h-6 absolute top-0 left-0 flex justify-center items-center pointer-events-none z-20 bg-gradient-to-b from-black/10 to-transparent">
                <div class="w-12 h-1 bg-white/50 rounded-full shadow-sm"></div>
            </div>

            <!-- Left: Preview -->
            <div class="h-2/5 md:h-auto md:min-h-[500px] md:w-1/2 bg-muted/30 checkerboard relative flex items-center justify-center p-6 border-b md:border-b-0 md:border-r border-border group overflow-hidden">
                <template x-if="['images', 'svg'].includes(currentAsset.category) || currentAsset.type === 'image'">
                    <img :src="currentAsset.fullPath" class="max-w-full max-h-full object-contain shadow-sm rounded-md transition-transform" alt="Preview">
                </template>
                <template x-if="currentAsset.category === 'video'">
                    <video controls class="max-w-full max-h-full rounded-lg shadow-lg bg-black" :src="currentAsset.fullPath"></video>
                </template>
                <template x-if="currentAsset.category === 'audio'">
                    <div class="text-center w-full max-w-xs bg-card p-6 rounded-xl shadow-sm border border-border">
                        <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4 text-primary">
                            <i class="bi bi-music-note-beamed text-3xl"></i>
                        </div>
                        <audio controls class="w-full" :src="currentAsset.fullPath"></audio>
                    </div>
                </template>
                <template x-if="!['images', 'svg', 'audio', 'video'].includes(currentAsset.category) && currentAsset.type !== 'image'">
                    <div class="text-center text-muted-foreground">
                        <i :class="getIconForType(currentAsset.category)" class="text-8xl opacity-50"></i>
                        <p class="mt-4 font-medium">প্রিভিউ নেই</p>
                    </div>
                </template>
                
                <button @click="closeModal()" class="md:hidden absolute top-4 right-4 bg-black/50 text-white rounded-full p-2 hover:bg-black/70 backdrop-blur-md transition-colors z-20">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <!-- Right: Details -->
            <div class="flex-1 flex flex-col h-3/5 md:h-auto bg-card">
                <!-- Header -->
                <div class="p-5 border-b border-border flex justify-between items-start shrink-0">
                    <div class="pr-8">
                        <h2 class="text-xl font-bold leading-tight break-all" x-text="currentAsset.name"></h2>
                        <p class="text-sm text-muted-foreground mt-1" x-text="(currentAsset.size || 'N/A') + ' • ' + (formatDate(currentAsset.date) || 'No Date')"></p>
                    </div>
                    <button @click="closeModal()" class="hidden md:block text-muted-foreground hover:text-foreground transition-colors p-1">
                        <i class="bi bi-x-lg text-lg"></i>
                    </button>
                </div>

                <!-- Code Tabs -->
                <div class="flex-1 overflow-y-auto p-5">
                    <div class="mb-4">
                        <label class="text-xs font-bold text-muted-foreground uppercase tracking-wider mb-2 block">কোড কপি করুন</label>
                        <div class="flex gap-1 p-1 bg-muted rounded-lg mb-3">
                            <template x-for="tab in currentAssetCode.tabs" :key="tab.id">
                                <button @click="activeTab = tab.id" 
                                    :class="activeTab === tab.id ? 'bg-background text-foreground shadow-sm' : 'text-muted-foreground hover:text-foreground'"
                                    class="flex-1 py-1.5 text-xs font-bold rounded-md transition-all text-center truncate px-1" 
                                    x-text="tab.name"></button>
                            </template>
                        </div>
                        <div class="relative group">
                            <div class="bg-secondary/50 border border-border rounded-xl p-4 overflow-x-auto h-24 flex items-center">
                                <code class="text-xs font-mono text-foreground whitespace-nowrap" x-text="getCodeContent()"></code>
                            </div>
                            <button @click="copyToClipboard(getCodeContent(), 'Code')" class="absolute top-2 right-2 p-1.5 rounded-md bg-background border border-border text-muted-foreground hover:text-foreground hover:border-primary shadow-sm transition-all active:scale-95" title="Copy">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Meta Info Grid -->
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div class="p-3 bg-muted/30 rounded-lg border border-border">
                            <div class="text-xs text-muted-foreground mb-1">ফাইল টাইপ</div>
                            <div class="text-sm font-medium uppercase" x-text="currentAsset.extension"></div>
                        </div>
                        <div class="p-3 bg-muted/30 rounded-lg border border-border">
                            <div class="text-xs text-muted-foreground mb-1">ক্যাটাগরি</div>
                            <div class="text-sm font-medium capitalize" x-text="currentAsset.category"></div>
                        </div>
                    </div>
                </div>

                <!-- Footer Actions -->
                <div class="p-5 border-t border-border bg-muted/10 md:bg-transparent pb-safe shrink-0">
                    <a :href="currentAsset.fullPath" target="_blank" download class="flex items-center justify-center gap-2 w-full bg-primary text-primary-foreground hover:bg-primary/90 py-3 rounded-xl font-bold transition-all shadow-lg shadow-primary/20 active:scale-95">
                        <i class="bi bi-download"></i> ডাউনলোড ফাইল
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div x-show="showCopyNotification" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-y-10 scale-90"
         x-transition:enter-end="opacity-100 translate-y-0 scale-100"
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100 translate-y-0 scale-100"
         x-transition:leave-end="opacity-0 translate-y-10 scale-90"
         class="fixed bottom-20 md:bottom-8 left-1/2 -translate-x-1/2 z-[100] bg-foreground text-background px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 border border-border" x-cloak>
        <i class="bi bi-check-circle-fill text-green-500"></i>
        <span x-text="copyNotificationMessage" class="font-medium text-sm"></span>
    </div>

    <script>
        function appState() {
            // Configuration
            const ASSETS_JSON_URL = 'https://cdnmx.pages.dev/assets/json/assets.json';
            const BASE_URL = 'https://cdnmx.pages.dev/';
            
            // Mock Data for fallback if fetch fails
            const MOCK_DATA = [
                { id: 1, name: 'Sample Image 1', path: 'assets/img/sample1.jpg', size: '1.2 MB', date: '2023-10-15', category: 'images', type: 'image', extension: 'jpg' },
                { id: 2, name: 'Project Logo', path: 'assets/logos/logo.png', size: '45 KB', date: '2023-11-01', category: 'images', type: 'image', extension: 'png' },
                { id: 3, name: 'Intro Video', path: 'assets/video/intro.mp4', size: '15.5 MB', date: '2023-09-20', category: 'video', type: 'video', extension: 'mp4' },
                { id: 4, name: 'Theme Song', path: 'assets/audio/theme.mp3', size: '3.2 MB', date: '2023-08-10', category: 'audio', type: 'audio', extension: 'mp3' },
                { id: 5, name: 'User Manual', path: 'assets/docs/manual.pdf', size: '2.1 MB', date: '2023-12-05', category: 'docs', type: 'pdf', extension: 'pdf' },
                { id: 6, name: 'Config JSON', path: 'assets/config/data.json', size: '2 KB', date: '2024-01-10', category: 'docs', type: 'json', extension: 'json' },
                { id: 7, name: 'Noto Sans Font', path: 'assets/fonts/noto.woff2', size: '120 KB', date: '2023-05-15', category: 'fonts', type: 'font', extension: 'woff2' },
                { id: 8, name: 'Vector Icon', path: 'assets/icons/home.svg', size: '1 KB', date: '2023-11-20', category: 'images', type: 'svg', extension: 'svg' },
            ];

            return {
                // State Variables
                isLoading: true,
                isDarkMode: false,
                viewMode: 'grid', // 'grid' or 'list'
                sortBy: 'date', // 'name', 'date', 'size'
                searchTerm: '',
                activeCategory: 'all',
                isModalOpen: false,
                mobileFilterOpen: false,
                activeTab: 'url',
                
                // Data Containers
                currentAsset: {},
                currentAssetCode: { tabs: [] },
                assets: [],
                categories: [
                    { id: 'images', name: 'ইমেজ', icon: 'bi bi-image' },
                    { id: 'video', name: 'ভিডিও', icon: 'bi bi-play-btn' },
                    { id: 'audio', name: 'অডিও', icon: 'bi bi-music-note-beamed' },
                    { id: 'fonts', name: 'ফন্ট', icon: 'bi bi-type' },
                    { id: 'docs', name: 'ডক্স', icon: 'bi bi-file-text' }
                ],
                
                // Notification State
                showCopyNotification: false,
                copyNotificationMessage: '',
                
                BASE_URL: BASE_URL,

                init() {
                    // Check local storage immediately
                    const savedTheme = localStorage.getItem('isDarkMode');
                    if (savedTheme === 'true' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        this.isDarkMode = true;
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }

                    // Watch theme for changes
                    this.$watch('isDarkMode', val => {
                        localStorage.setItem('isDarkMode', val);
                        if (val) document.documentElement.classList.add('dark');
                        else document.documentElement.classList.remove('dark');
                    });
                    
                    // Body scroll lock effect
                    this.$watch('isModalOpen', val => {
                        if (val) document.body.style.overflow = 'hidden';
                        else document.body.style.overflow = '';
                    });

                    // Fetch Data
                    fetch(ASSETS_JSON_URL)
                        .then(res => {
                            if (!res.ok) throw new Error('Network error');
                            return res.json();
                        })
                        .then(data => {
                            if (!Array.isArray(data) || data.length === 0) throw new Error('Empty data');
                            this.assets = data.map(a => this.processAsset(a));
                        })
                        .catch(err => {
                            console.warn('Using mock data due to fetch error:', err);
                            this.assets = MOCK_DATA.map(a => this.processAsset(a));
                        })
                        .finally(() => {
                            setTimeout(() => this.isLoading = false, 500); 
                        });
                },

                processAsset(asset) {
                    const fullPath = asset.path.startsWith('http') ? asset.path : this.BASE_URL + asset.path;
                    const extension = asset.extension || asset.path.split('.').pop().toLowerCase();
                    return {
                        ...asset,
                        fullPath: fullPath,
                        extension: extension,
                        date: asset.date || '2023-01-01',
                        type: asset.type || 'file'
                    };
                },

                toggleTheme() {
                    this.isDarkMode = !this.isDarkMode;
                },

                get sortedAndFilteredAssets() {
                    let filtered = this.assets;
                    
                    if (this.activeCategory !== 'all') {
                        filtered = filtered.filter(a => a.category === this.activeCategory);
                    }
                    
                    if (this.searchTerm) {
                        const term = this.searchTerm.toLowerCase();
                        filtered = filtered.filter(a => 
                            (a.name && a.name.toLowerCase().includes(term)) || 
                            (a.extension && a.extension.toLowerCase().includes(term))
                        );
                    }
                    
                    return [...filtered].sort((a, b) => {
                        if (this.sortBy === 'name') return (a.name || '').localeCompare(b.name || '', 'bn');
                        if (this.sortBy === 'date') return new Date(b.date || 0) - new Date(a.date || 0);
                        if (this.sortBy === 'size') return this.parseSize(a.size) - this.parseSize(b.size);
                        return 0;
                    });
                },

                parseSize(sizeStr) {
                    if (!sizeStr) return 0;
                    const units = { 'B': 1, 'KB': 1024, 'MB': 1048576, 'GB': 1073741824, 'TB': 1099511627776 };
                    // Regex handles optional space (e.g., "1.5MB" or "1.5 MB")
                    const regex = /(\d+(?:\.\d+)?)\s*(B|KB|MB|GB|TB)/i;
                    const match = sizeStr.match(regex);
                    return match ? parseFloat(match[1]) * (units[match[2].toUpperCase()] || 1) : 0;
                },

                formatDate(dateStr) {
                    if (!dateStr) return '';
                    try {
                        return new Date(dateStr).toLocaleDateString('bn-BD', {
                            year: 'numeric', month: 'short', day: 'numeric'
                        });
                    } catch (e) {
                        return dateStr;
                    }
                },

                getSortLabel(val) {
                    const labels = { 'name': 'নাম', 'date': 'তারিখ', 'size': 'সাইজ' };
                    return labels[val] || val;
                },

                setActiveCategory(category) { 
                    this.activeCategory = category; 
                    this.mobileFilterOpen = false;
                    document.getElementById('main-scroll').scrollTo({ top: 0, behavior: 'smooth' });
                },

                getIconForType(type) {
                    const icons = { 
                        images: 'bi bi-image', 
                        image: 'bi bi-image', 
                        svg: 'bi bi-filetype-svg', 
                        video: 'bi bi-film', 
                        audio: 'bi bi-music-note-beamed', 
                        fonts: 'bi bi-file-earmark-font', 
                        font: 'bi bi-file-earmark-font',
                        json: 'bi bi-file-code', 
                        docs: 'bi bi-file-text',
                        doc: 'bi bi-file-text', 
                        pdf: 'bi bi-file-pdf-fill', 
                        css: 'bi bi-filetype-css' 
                    };
                    return icons[type] || 'bi bi-file-earmark';
                },

                getCodeContent() {
                    const tab = this.currentAssetCode.tabs.find(t => t.id === this.activeTab);
                    return tab ? tab.code : '';
                },

                copyToClipboard(text, type) {
                    if (!text) return;
                    
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(text).then(() => {
                            this.triggerNotification(type);
                        }).catch(err => {
                            console.error('Async copy failed', err);
                            this.fallbackCopy(text, type);
                        });
                    } else {
                        this.fallbackCopy(text, type);
                    }
                },

                fallbackCopy(text, type) {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        this.triggerNotification(type);
                    } catch (err) {
                        console.error('Fallback copy failed', err);
                    }
                    document.body.removeChild(textArea);
                },

                triggerNotification(type) {
                    this.copyNotificationMessage = `${type} কপি হয়েছে`;
                    this.showCopyNotification = true;
                    setTimeout(() => this.showCopyNotification = false, 2000);
                },

                openModal(asset) {
                    this.currentAsset = asset;
                    const url = asset.fullPath;
                    let tabs = [];
                    
                    tabs.push({ id: 'url', name: 'URL', code: url });
                    
                    if (['images', 'svg'].includes(asset.category) || asset.type === 'image') {
                        tabs.push({ id: 'html', name: 'HTML', code: `<img src="${url}" alt="${asset.name}">` });
                        tabs.push({ id: 'markdown', name: 'Markdown', code: `![${asset.name}](${url})` });
                        tabs.push({ id: 'css', name: 'CSS', code: `background-image: url('${url}');` });
                    } else if (asset.extension === 'css') {
                        tabs.push({ id: 'html', name: 'Link Tag', code: `<link rel="stylesheet" href="${url}">` });
                    } else if (asset.extension === 'js') {
                        tabs.push({ id: 'html', name: 'Script Tag', code: `<script src="${url}"><\/script>` });
                    }
                    
                    this.currentAssetCode.tabs = tabs;
                    this.activeTab = tabs[0]?.id || 'url';
                    this.isModalOpen = true;
                },
                
                closeModal() {
                    this.isModalOpen = false;
                }
            };
        }
    </script>
</body>
</html>
